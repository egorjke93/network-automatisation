
–û–∫, –¥–∞–≤–∞–π **—Ñ–∏–Ω–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é —Å—Ö–µ–º—É** ‚Äî –≤ –≤–∏–¥–µ **–ª–æ–≥–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã**, –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É. –≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, –∫ —á–µ–º—É —Ç–≤–æ–π –∫–æ–¥ **—É–∂–µ –ø–æ—á—Ç–∏ –ø—Ä–∏—à—ë–ª**, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞ –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

–ù–∏–∂–µ ‚Äî **—Ü–µ–ª–µ–≤–∞—è —Å—Ö–µ–º–∞**, –∫ –∫–æ—Ç–æ—Ä–æ–π –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –∏–¥—Ç–∏.

---

## üéØ –¶–ï–õ–¨ –ê–†–•–ò–¢–ï–ö–¢–£–†–´

* –ù–∞–¥—ë–∂–Ω—ã–π backend-—Å–µ—Ä–≤–∏—Å
* –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π (–¥–ª—è —Ç–µ–±—è –∏ –∫–æ–ª–ª–µ–≥)
* UI / API –ø–æ–≤–µ—Ä—Ö
* –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–µ–Ω–¥–æ—Ä–æ–≤
* –ú–∏–Ω–∏–º—É–º –ø–µ—Ä–µ–¥–µ–ª–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞

---

## üß± –§–ò–ù–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ß–ï–°–ö–ê–Ø –°–•–ï–ú–ê

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            UI               ‚îÇ
‚îÇ  (Web / CLI / Grafana / NB) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          API Layer          ‚îÇ
‚îÇ  FastAPI / REST / gRPC      ‚îÇ
‚îÇ  - auth                     ‚îÇ
‚îÇ  - validation               ‚îÇ
‚îÇ  - versioning               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Application          ‚îÇ
‚îÇ        (Use Cases)          ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  collect_interfaces()       ‚îÇ
‚îÇ  sync_to_netbox()            ‚îÇ
‚îÇ  diff_state()               ‚îÇ
‚îÇ  export()                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Domain             ‚îÇ  ‚Üê –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï
‚îÇ   (Vendor-agnostic models)   ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  Interface                  ‚îÇ
‚îÇ  Device                     ‚îÇ
‚îÇ  LAG                         ‚îÇ
‚îÇ  VLAN                        ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  Interface.port_type         ‚îÇ
‚îÇ  Interface.mode              ‚îÇ
‚îÇ  Interface.media_type        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Infrastructure         ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  Collectors                 ‚îÇ
‚îÇ   - InterfaceCollector      ‚îÇ ‚Üê –¢–í–û–ô –ö–û–î
‚îÇ   - VLANCollector           ‚îÇ
‚îÇ   - LLDPCollector           ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  Parsers                    ‚îÇ
‚îÇ   - NTC                     ‚îÇ
‚îÇ   - Regex fallback          ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  Connections                ‚îÇ
‚îÇ   - SSH                     ‚îÇ
‚îÇ   - Netmiko / Scrapli       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     External Systems        ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ  Cisco / Arista / Juniper   ‚îÇ
‚îÇ  NetBox                     ‚îÇ
‚îÇ  Monitoring                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç –ì–î–ï –¢–´ –°–ï–ô–ß–ê–°

–ï—Å–ª–∏ —á–µ—Å—Ç–Ω–æ –∏ —Ç–æ—á–Ω–æ:

```
Infrastructure + Domain (—Å–º–µ—à–∞–Ω—ã)
```

–¢–≤–æ–π `InterfaceCollector`:

* ‚ùå –∑–Ω–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
* ‚ùå —Ä–µ—à–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
* ‚ùå –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥ NetBox
* ‚ùå –¥–µ—Ç–µ–∫—Ç–∏—Ç port_type –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞

–ù–û
üëâ **–≤—Å—ë —ç—Ç–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–æ**, –ø—Ä–æ—Å—Ç–æ –ª–µ–∂–∏—Ç –Ω–µ —Ç–∞–º.

---

## üß† –ö–õ–Æ–ß–ï–í–û–ï –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –†–ï–®–ï–ù–ò–ï

### ‚úÇÔ∏è –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 3 —Å–ª–æ—è (–±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è)

### 1Ô∏è‚É£ Infrastructure (–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—á—Ç–∏ –∫–∞–∫ –µ—Å—Ç—å)

–¢–≤–æ–π –∫–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç—É—Ç:

```python
InterfaceCollector
  ‚îú‚îÄ –∑–Ω–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã
  ‚îú‚îÄ –ø–∞—Ä—Å–∏—Ç –≤—ã–≤–æ–¥
  ‚îú‚îÄ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "—Å—ã—Ä—ã–µ, –Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ
```

**–ù–û:**

* `_detect_port_type()` ‚Üí —É–±—Ä–∞—Ç—å
* NetBox-—Å–ø–µ—Ü–∏—Ñ–∏–∫—É ‚Üí —É–±—Ä–∞—Ç—å
* `mode/tagged-all` ‚Üí –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—ã—à–µ

---

### 2Ô∏è‚É£ Domain (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–ª–æ–π)

–ù–æ–≤—ã–π –∫–æ–¥, **–º–∞–ª–µ–Ω—å–∫–∏–π –∏ —á–∏—Å—Ç—ã–π**:

```python
@dataclass
class Interface:
    name: str
    status: InterfaceStatus
    media: MediaType
    mode: SwitchportMode
    lag: Optional[str]
```

–ò —Å–µ—Ä–≤–∏—Å—ã:

```python
class InterfaceClassifier:
    def detect_port_type(interface) -> PortType
```

üëâ –í–ê–ñ–ù–û:
**Domain –Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏ Cisco, –Ω–∏ NX-OS, –Ω–∏ NTC**

---

### 3Ô∏è‚É£ Application (—Ç–æ–Ω–∫–∏–π glue-–∫–æ–¥)

```python
raw = collector.collect(devices)
interfaces = InterfaceMapper.from_raw(raw)
```

---

## üõ† –°–õ–û–ñ–ù–û –õ–ò –ü–ï–†–ï–î–ï–õ–ê–¢–¨?

**–ß–µ—Å—Ç–Ω–æ: –Ω–µ—Ç.**

–û—Ü–µ–Ω–∫–∞:

* 70% –∫–æ–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è
* 20% –ø–µ—Ä–µ–Ω–æ—Å –ª–æ–≥–∏–∫–∏
* 10% —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏–º—ë–Ω

–¢—ã **–Ω–µ –≤—ã–∫–∏–¥—ã–≤–∞–µ—à—å**, –∞ **—Ä–∞—Å—Å—Ç–∞–≤–ª—è–µ—à—å –ø–æ –º–µ—Å—Ç–∞–º**.

---

## üìà –ë–£–î–ï–¢ –õ–ò –°–ü–†–û–° –ù–ê –≠–¢–û –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï?

–î–∞. –ü—Ä–∏—á–∏–Ω—ã:

* NetBox —Å—Ç–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º
* Network Source of Truth ‚Äî —Ç—Ä–µ–Ω–¥
* –ö–æ–º–ø–∞–Ω–∏–∏ —É—Å—Ç–∞–ª–∏ –æ—Ç Ansible-—Å–∫—Ä–∏–ø—Ç–æ–≤ ¬´–Ω–∞ –∫–æ–ª–µ–Ω–∫–µ¬ª
* –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ **–ø–æ–Ω–∏–º–∞—é—Ç –¥–æ–º–µ–Ω**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–¥ ‚Äî –º–∞–ª–æ

üëâ –û—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω—è—Ç—Å—è –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ:

* –º—ã—Å–ª—è—Ç –º–æ–¥–µ–ª—è–º–∏
* —É–º–µ—é—Ç –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞—Ç—å –≤–µ–Ω–¥–æ—Ä–æ–≤
* —Å—Ç—Ä–æ—è—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –∞ –Ω–µ —Å–∫—Ä–∏–ø—Ç—ã

---

## üß© –¢–í–û–Ø –†–û–õ–¨ (–æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç)

> ¬´—è –±–æ–ª—å—à–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Å –∏–∏ —Ä–∞–±–æ—Ç–∞—é, –∫–æ–¥ –∑–Ω–∞—é –Ω–µ —Å–ª–∏—à–∫–æ–º¬ª

–≠—Ç–æ **–ù–ï –º–∏–Ω—É—Å**.

–¢—ã:

* –≤–∏–¥–∏—à—å —Ü–µ–ª–æ—Å—Ç–Ω—É—é –º–æ–¥–µ–ª—å
* –∑–Ω–∞–µ—à—å —Å–µ—Ç—å
* –ø–æ–Ω–∏–º–∞–µ—à—å, –∑–∞—á–µ–º —ç—Ç–æ –±–∏–∑–Ω–µ—Å—É

–ò–ò:

* –¥–æ–ø–∏—à–µ—Ç –∫–æ–¥
* –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç
* –ø–æ–∫—Ä–æ–µ—Ç —Ç–µ—Å—Ç–∞–º–∏

üëâ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä + –ò–ò = —Å–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è**

---

## ‚úÖ –ò–¢–û–ì

–¢—ã:

* –≤—ã–±—Ä–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
* —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª —Å–∏–ª—å–Ω–æ–µ —è–¥—Ä–æ
* –Ω–∞—Ö–æ–¥–∏—à—å—Å—è **–≤ 1‚Äì2 —à–∞–≥–∞—Ö** –æ—Ç –ø—Ä–æ–¥—É–∫—Ç–∞

### –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å):

1. –Ø –º–æ–≥—É **—Ä–∞–∑—Ä–µ–∑–∞—Ç—å —Ç–≤–æ–π –∫–æ–¥ –ø–æ —Å–ª–æ—è–º**
2. –ò–ª–∏ –ø–æ–º–æ—á—å **—Å Domain-–º–æ–¥–µ–ª—å—é**
3. –ò–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å, **–∫–∞–∫ –∏–∑ —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å UI/API**

–°–∫–∞–∂–∏, –∫—É–¥–∞ –∏–¥—ë–º –¥–∞–ª—å—à–µ üëç
---

# üß± –¶–µ–ª—å —ç—Ç–∞–ø–∞

–°–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É:

* **–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π**
* **–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π**
* **–±–µ–∑–æ–ø–∞—Å–Ω–æ–π**
* **–≥–æ—Ç–æ–≤–æ–π –∫ —Ä–æ—Å—Ç—É**, –Ω–æ –±–µ–∑ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞

---

# üî¥ PRIORITY 1 ‚Äî –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

## 1Ô∏è‚É£ Run / Execution Context (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)

### –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å

–í–≤–µ—Å—Ç–∏ **–∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—É—Å–∫–∞**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ.

```python
class RunContext:
    run_id: str
    started_at: datetime
    dry_run: bool
    triggered_by: str  # cli / cron / api
```

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

* –ª–æ–≥–∏
* sync —Å NetBox
* –æ—à–∏–±–∫–∏
* —ç–∫—Å–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤

```text
reports/
‚îî‚îÄ‚îÄ run_2025-03-14T12-30-22/
     ‚îú‚îÄ‚îÄ mac.xlsx
     ‚îú‚îÄ‚îÄ interfaces.json
     ‚îî‚îÄ‚îÄ summary.json
```

### –ü–æ—á–µ–º—É —ç—Ç–æ must-have

* –ª–µ–≥–∫–æ –¥–µ–±–∞–∂–∏—Ç—å
* –ª–µ–≥–∫–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å
* –±–µ–∑–æ–ø–∞—Å–Ω—ã–π cleanup

‚è± 0.5‚Äì1 –¥–µ–Ω—å
üî• **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç**

---

## 2Ô∏è‚É£ –°—Ç—Ä–æ–≥–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)

### –°–µ–π—á–∞—Å (—Ç–∏–ø–∏—á–Ω–æ)

```python
dict[str, Any]
```

### –ù—É–∂–Ω–æ

```python
@dataclass
class InterfaceState:
    name: str
    enabled: bool
    description: str | None
    mac: str | None
    port_type: str | None
```

### –ì–¥–µ

* –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
* –¥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
* –¥–æ NetBox

### –ß—Ç–æ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç

* –æ—à–∏–±–∫–∏ –ª–æ–≤—è—Ç—Å—è —Ä–∞–Ω—å—à–µ
* —Ç–µ—Å—Ç—ã –ø—Ä–æ—â–µ
* diff —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–µ–Ω

‚è± 1‚Äì2 –¥–Ω—è
üíé **–û–≥—Ä–æ–º–Ω—ã–π –ø–ª—é—Å –∫ –∫–∞—á–µ—Å—Ç–≤—É**

---

## 3Ô∏è‚É£ Diff –ø–µ—Ä–µ–¥ Apply (–±–µ–∑ —ç—Ç–æ–≥–æ –¥–∞–ª—å—à–µ –Ω–µ–ª—å–∑—è)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```text
Collector ‚Üí DesiredState
NetBox ‚Üí ActualState
           ‚Üì
         Diff
           ‚Üì
        Apply | Dry-run
```

### –ü—Ä–∏–º–µ—Ä

```python
diff = InterfaceDiff(desired, actual)

if diff.has_changes():
    sync.apply(diff)
```

### –ü–æ—á–µ–º—É

* –Ω–µ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
* –ø–æ–Ω—è—Ç–Ω—ã–π dry-run
* –∞—É–¥–∏—Ç

‚è± 1‚Äì2 –¥–Ω—è
üö® **–ë–µ–∑ diff –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–ø–∞—Å–Ω–∞**

---

# üü† PRIORITY 2 ‚Äî –û—à–∏–±–∫–∏, –ª–æ–≥–∏, —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

## 4Ô∏è‚É£ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### –í–≤–µ—Å—Ç–∏ –±–∞–∑–æ–≤—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é

```python
class CollectorError(Exception): ...
class SSHError(CollectorError): ...
class ParseError(CollectorError): ...
class NetBoxError(CollectorError): ...
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

* retries
* —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
* –æ—Ç—á—ë—Ç—ã

‚è± 0.5 –¥–Ω—è

---

## 5Ô∏è‚É£ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏

### –ù–µ —Ç–∞–∫

```text
ERROR: failed
```

### –ê —Ç–∞–∫

```json
{
  "run_id": "...",
  "device": "SW1",
  "collector": "mac",
  "error": "ParseError",
  "command": "show mac address-table"
}
```

### –ú–∏–Ω–∏–º—É–º

* `run_id`
* `device`
* `collector`
* `stage`

‚è± 0.5‚Äì1 –¥–µ–Ω—å

---

## 6Ô∏è‚É£ –¢–µ—Å—Ç—ã (–±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞)

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

| –ß—Ç–æ           | –¢–∏–ø  |
| ------------- | ---- |
| –ø–∞—Ä—Å–µ—Ä—ã       | unit |
| –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é  | unit |
| diff          | unit |
| NetBox client | mock |

### –ü—Ä–∏–º–µ—Ä

```python
def test_mac_parser():
    output = load_fixture("show_mac.txt")
    result = parse_mac(output)
    assert result[0].mac == "0011.2233.4455"
```

‚è± 1‚Äì2 –¥–Ω—è

---

# üü° PRIORITY 3 ‚Äî –ö–æ–Ω—Ñ–∏–≥–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## 7Ô∏è‚É£ –í–∞–ª–∏–¥–∞—Ü–∏—è config.yaml

### –°–µ–π—á–∞—Å

* runtime errors

### –ù—É–∂–Ω–æ

```python
class NetBoxConfig(BaseModel):
    url: HttpUrl
    token: SecretStr
```

(Pydantic)

‚è± 0.5 –¥–Ω—è

---

## 8Ô∏è‚É£ –°–µ–∫—Ä–µ—Ç—ã ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞

### Best practice (–¥–ª—è —Ç–µ–±—è)

| –ß—Ç–æ          | –ì–¥–µ                        |
| ------------ | -------------------------- |
| NetBox token | Windows Credential Manager |
| Device creds | –≤–≤–æ–¥ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ           |
| config.yaml  | –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤               |

### –í –∫–æ–¥–µ

```python
token = get_credential("netbox", "api_token")
```

‚è± 0.5 –¥–Ω—è

---

# üß© PRIORITY 4 ‚Äî –£–±–æ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## 9Ô∏è‚É£ –ß—ë—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å–ª–æ—ë–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞

* collectors **–Ω–µ –∑–Ω–∞—é—Ç –ø—Ä–æ NetBox**
* exporters **–Ω–µ –∑–Ω–∞—é—Ç –ø—Ä–æ SSH**
* sync **–Ω–µ –ø–∞—Ä—Å–∏—Ç CLI**

–ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–æ ‚Äî –≤—ã–Ω–µ—Å—Ç–∏.

‚è± 0.5‚Äì1 –¥–µ–Ω—å

---

## üîü –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–∞–∫ –∫–æ–¥

### –ú–∏–Ω–∏–º—É–º

* `ARCHITECTURE.md` ‚úî (—É–∂–µ –µ—Å—Ç—å)
* `DECISIONS.md` ‚Äî –ø–æ—á–µ–º—É —Ç–∞–∫
* `CONTRIBUTING.md` ‚Äî –∫–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å

‚è± 0.5 –¥–Ω—è

---

# üß≠ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ (—Ä–µ–∞–ª—å–Ω—ã–π)

```
1. RunContext
2. Data models
3. Diff
4. Errors
5. Logs
6. Tests
7. Config validation
8. Secrets
9. Cleanup boundaries
```

üëâ **–≠—Ç–æ ~1‚Äì2 –Ω–µ–¥–µ–ª–∏ —Å–ø–æ–∫–æ–π–Ω–æ–π, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã**

---

# üß† –ì–ª–∞–≤–Ω–æ–µ

–¢—ã **—É–∂–µ –ø–µ—Ä–µ—Ä–æ—Å —É—Ä–æ–≤–µ–Ω—å ‚Äú—Å–∫—Ä–∏–ø—Ç‚Äù**.
–°–µ–π—á–∞—Å —Ç—ã –¥–µ–ª–∞–µ—à—å **–∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —Ü–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∏–º–µ–Ω–Ω–æ –µ–≥–æ –ø–æ—á—Ç–∏ –Ω–∏–∫—Ç–æ –Ω–µ –¥–µ–ª–∞–µ—Ç.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–≥—É:

* —Ä–∞–∑–æ–±—Ä–∞—Ç—å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Ç–≤–æ–π –∫–æ–¥ –∏ —Å–∫–∞–∑–∞—Ç—å ‚Äú–≤—ã–Ω–µ—Å—Ç–∏ / –æ—Å—Ç–∞–≤–∏—Ç—å‚Äù**
* –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å **RunContext + Diff skeleton**
* —Å–æ—Å—Ç–∞–≤–∏—Ç—å **Definition of Done –¥–ª—è ‚Äú–ø—Ä–∏—á–µ—Å–∞–Ω–æ‚Äù**

–°–∫–∞–∂–∏, —Å –∫–∞–∫–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –Ω–∞—á–Ω—ë–º ‚Äî —è –ø—Ä–æ–≤–µ–¥—É —Ç–µ–±—è –ø–æ—à–∞–≥–æ–≤–æ üëå


–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –û—Ç–≤–µ—á—É **–ø–æ–¥—Ä–æ–±–Ω–æ, –ø–æ-–∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–º—É**, –±–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –∏ –±–µ–∑ ¬´–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –≤—Å—ë¬ª.
–°–ø–æ–π–ª–µ—Ä: **—ç—Ç–æ –Ω–µ —Å–ª–æ–∂–Ω–æ**, –µ—Å–ª–∏ –¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –≠—Ç–æ **—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –∞ –Ω–µ –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**.

---

# ü•á PRIORITY 1 ‚Äî Domain layer

**(—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∏ —Å–∞–º–æ–µ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥)**

## –ß—Ç–æ —ç—Ç–æ –ü–†–û–°–¢–´–ú–ò –°–õ–û–í–ê–ú–ò

> Domain layer ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ —Ç—ã –æ–ø–∏—Å—ã–≤–∞–µ—à—å **–∫–∞–∫ –¥–æ–ª–∂–Ω–∞ –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–µ—Ç—å**,
> –∞ –Ω–µ **–∫–∞–∫ —Ç—ã –µ—ë —Å–æ–±–∏—Ä–∞–µ—à—å –∏–ª–∏ –∫—É–¥–∞ —Ç—ã –µ—ë –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å**.

–°–µ–π—á–∞—Å —É —Ç–µ–±—è –ª–æ–≥–∏–∫–∞ —Ç–∏–ø–∞:

* –µ—Å–ª–∏ speed —Ç–∞–∫–æ–π ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å
* –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–∞–∫–æ–π ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
* –µ—Å–ª–∏ LAG ‚Üí –æ—Å–æ–±–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ù–æ —ç—Ç–∞ –ª–æ–≥–∏–∫–∞:

* —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ collectors
* —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ netbox/sync

üëâ Domain layer **—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ**.

---

## –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –°–ï–ô–ß–ê–° (—Ç–∏–ø–∏—á–Ω–æ)

```python
# collectors/interfaces.py
if row["speed"] != nb_interface.speed:
¬†¬†¬† update_interface(...)
```

‚ùå collector —Ä–µ—à–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

---

## –ö–∞–∫ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å

```python
# domain/interface.py
class InterfaceState:
¬†¬†¬† def needs_update(self, nb_obj) -> bool:
¬†¬†¬†¬†¬†¬†¬† return self.speed != nb_obj.speed
```

```python
# netbox/sync.py
if iface_state.needs_update(nb_iface):
¬†¬†¬† nb.update_interface(...)
```

---

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Domain —Å–ª–æ–π (—Ä–µ–∞–ª—å–Ω–æ)

```
core/domain/
¬† interface.py
¬† device.py
¬† lag.py
```

### –ü—Ä–∏–º–µ—Ä (–º–∏–Ω–∏–º—É–º)

```python
@dataclass
class InterfaceState:
¬†¬†¬† name: str
¬†¬†¬† speed: int
¬†¬†¬† admin_up: bool

¬†¬†¬† def differs(self, nb) -> bool:
¬†¬†¬†¬†¬†¬†¬† return (
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† self.speed != nb.speed or
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† self.admin_up != nb.enabled
¬†¬†¬†¬†¬†¬†¬† )
```

---

## –°–ª–æ–∂–Ω–æ –ª–∏?

**–ù–µ—Ç.**
–≠—Ç–æ:

* –ø–µ—Ä–µ–Ω–æ—Å –ª–æ–≥–∏–∫–∏
* –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è

‚è± **1‚Äì2 –¥–Ω—è**, –º–∞–∫—Å–∏–º—É–º **3**, –¥–∞–∂–µ –≤ –±–æ–ª—å—à–æ–º –ø—Ä–æ–µ–∫—Ç–µ.

---

## –ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å

* –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Å–µ—Ç–∏
* –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑ –ª–æ–º–∫–∏ collectors
* –∫–æ–¥ —Å—Ä–∞–∑—É —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ ‚Äú—Å–µ—Ç–µ–≤–∞—è –º–æ–¥–µ–ª—å‚Äù

---

# ü•à PRIORITY 2 ‚Äî –Ø–≤–Ω—ã–π Pipeline

## –ß—Ç–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

> Pipeline ‚Äî —ç—Ç–æ **—è–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**,
> –∞ –Ω–µ ‚Äúmain.py –≤—ã–∑—ã–≤–∞–µ—Ç 10 —Ñ—É–Ω–∫—Ü–∏–π –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ‚Äù.

---

## –ö–∞–∫ –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—Ç —Å–µ–π—á–∞—Å

```python
collect_devices()
collect_interfaces()
sync_devices()
sync_interfaces()
sync_links()
```

‚ùå

* –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω
* —Å–ª–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
* —Å–ª–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å web UI

---

## –ö–∞–∫ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å

```python
class SyncPipeline:
¬†¬†¬† steps = [
¬†¬†¬†¬†¬†¬†¬† CollectDevices,
¬†¬†¬†¬†¬†¬†¬† CollectInterfaces,
¬†¬†¬†¬†¬†¬†¬† SyncDevices,
¬†¬†¬†¬†¬†¬†¬† SyncInterfaces,
¬†¬†¬†¬†¬†¬†¬† SyncLinks,
¬†¬†¬† ]

¬†¬†¬† def run(self):
¬†¬†¬†¬†¬†¬†¬† for step in self.steps:
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† step.execute()
```

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ Step

```python
class Step:
¬†¬†¬† name = "sync_interfaces"

¬†¬†¬† def execute(self, ctx):
¬†¬†¬†¬†¬†¬†¬† ...
```

`ctx` ‚Äî –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:

* inventory
* config
* run_id
* dry_run

---

## –°–ª–æ–∂–Ω–æ –ª–∏?

**–í–æ–æ–±—â–µ –Ω–µ—Ç.**

–¢—ã:

* –ø—Ä–æ—Å—Ç–æ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—à—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
* –ù–ï –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—à—å –ª–æ–≥–∏–∫—É

‚è± **1 –¥–µ–Ω—å**, –º–∞–∫—Å–∏–º—É–º **2**.

---

## –ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å

* –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–ø—É—Å–∫–∞
* –º–æ–∂–Ω–æ:

¬† * –æ—Ç–∫–ª—é—á–∞—Ç—å —à–∞–≥–∏
¬† * –¥–µ–ª–∞—Ç—å dry-run
¬† * –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
* web UI –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞ –≤–µ—á–µ—Ä

---

# ü•â PRIORITY 3 ‚Äî Async execution backend

## –°–∞–º—ã–π —á–∞—Å—Ç—ã–π —Å—Ç—Ä–∞—Ö

> ‚Äú–ü—Ä–∏–¥—ë—Ç—Å—è –≤—Å—ë –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø–æ–¥ async‚Äù

‚ùå –ù–ï–¢.

---

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

> **–ù–µ –∑–∞–º–µ–Ω—è—Ç—å sync ‚Üí async**,
> –∞ **–¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π backend**.

---

## –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç

```python
class InterfaceCollector:
¬†¬†¬† def collect(self):
¬†¬†¬†¬†¬†¬†¬† return scrapli_sync()

¬†¬†¬† async def collect_async(self):
¬†¬†¬†¬†¬†¬†¬† return await scrapli_async()
```

CLI:

```
--mode sync
--mode async
```

---

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

```python
if mode == "async":
¬†¬†¬† await collector.collect_async()
else:
¬†¬†¬† collector.collect()
```

---

## –°–ª–æ–∂–Ω–æ –ª–∏?

* –µ—Å–ª–∏ —Ç—ã –∑–Ω–∞–µ—à—å Scrapli ‚Üí **–Ω–µ —Å–ª–æ–∂–Ω–æ**
* —Å–ª–æ–∂–Ω–æ—Å—Ç—å:

¬† * await
¬† * gather
¬† * timeouts

‚è± **2‚Äì4 –¥–Ω—è**, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ collectors.

---

## –ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å

* –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
* —Å–∫–æ—Ä–æ—Å—Ç—å
* –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ web
* –ø–ª—é—Å 100 –æ—á–∫–æ–≤ –Ω–∞ —Å–æ–±–µ—Å–µ

---

# ‚ùó –ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å (–æ—á–µ–Ω—å)

### –≠—Ç–∏ 3 –ø—É–Ω–∫—Ç–∞:

* **–ù–ï –ª–æ–º–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥**
* **–ù–ï —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**
* **–ù–ï —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**

–≠—Ç–æ:

* —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
* —Ñ–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
* –≤–∑—Ä–æ—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

---

# –ò—Ç–æ–≥ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

| –ü—É–Ω–∫—Ç¬†¬†¬†¬†¬†¬†¬†¬† | –°–ª–æ–∂–Ω–æ—Å—Ç—å¬† | –í—Ä–µ–º—è¬†¬† |
| ------------- | ---------- | ------- |
| Domain layer¬† | üü° –°—Ä–µ–¥–Ω—è—è | 1‚Äì3 –¥–Ω—è |
| Pipeline¬†¬†¬†¬†¬† | üü¢ –õ—ë–≥–∫–∞—è¬† | 1‚Äì2 –¥–Ω—è |
| Async backend | üü° –°—Ä–µ–¥–Ω—è—è | 2‚Äì4 –¥–Ω—è |

üëâ **–í —Å—É–º–º–µ 1‚Äì1.5 –Ω–µ–¥–µ–ª–∏**, –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞.







## –°–ü–†–ê–í–û–ß–ù–ò–ö –ö–û–ú–ê–ù–î CLI

### 1. devices ‚Äî –°–±–æ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
```bash
python -m network_collector devices [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--format`, `-f` | –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (excel/csv/json) | csv |
| `--delimiter` | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è CSV | , |
| `--site` | –°–∞–π—Ç –¥–ª—è NetBox | Main |
| `--role` | –†–æ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | Switch |
| `--manufacturer` | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | Cisco |

### 2. mac ‚Äî –°–±–æ—Ä MAC-–∞–¥—Ä–µ—Å–æ–≤
```bash
python -m network_collector mac [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--format`, `-f` | –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (excel/csv/json) | excel |
| `--delimiter` | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è CSV | , |
| `--mac-format` | –§–æ—Ä–º–∞—Ç MAC (ieee/cisco/unix) | –∏–∑ config |
| `--fields` | –ü–æ–ª—è –¥–ª—è –≤—ã–≤–æ–¥–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | –≤—Å–µ |
| `--with-descriptions` | –°–æ–±–∏—Ä–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ | –∏–∑ config |
| `--no-descriptions` | –ù–µ —Å–æ–±–∏—Ä–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è | - |
| `--include-trunk` | –í–∫–ª—é—á–∞—Ç—å trunk –ø–æ—Ä—Ç—ã | –∏–∑ config |
| `--exclude-trunk` | –ò—Å–∫–ª—é—á–∞—Ç—å trunk –ø–æ—Ä—Ç—ã | - |
| `--match-file` | Excel –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è MAC —Å —Ö–æ—Å—Ç–∞–º–∏ | - |
| `--per-device` | –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | - |
| `--with-port-security` | Sticky MAC –∏–∑ port-security | - |

### 3. lldp ‚Äî –°–±–æ—Ä LLDP/CDP —Å–æ—Å–µ–¥–µ–π
```bash
python -m network_collector lldp [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--format`, `-f` | –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (excel/csv/json) | excel |
| `--delimiter` | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è CSV | , |
| `--protocol` | –ü—Ä–æ—Ç–æ–∫–æ–ª (lldp/cdp/both) | lldp |
| `--fields` | –ü–æ–ª—è –¥–ª—è –≤—ã–≤–æ–¥–∞ | –≤—Å–µ |

### 4. interfaces ‚Äî –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
```bash
python -m network_collector interfaces [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--format`, `-f` | –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (excel/csv/json) | excel |
| `--delimiter` | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è CSV | , |
| `--fields` | –ü–æ–ª—è –¥–ª—è –≤—ã–≤–æ–¥–∞ | –≤—Å–µ |

### 5. inventory ‚Äî –°–±–æ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ (–º–æ–¥—É–ª–∏, SFP, PSU)
```bash
python -m network_collector inventory [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--format`, `-f` | –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (excel/csv/json) | json |
| `--delimiter` | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è CSV | , |
| `--fields` | –ü–æ–ª—è –¥–ª—è –≤—ã–≤–æ–¥–∞ | –≤—Å–µ |

### 6. run ‚Äî –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
```bash
python -m network_collector run "show version" [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `cmd` | –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
| `--platform` | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è NTC Templates | –∞–≤—Ç–æ |
| `--format`, `-f` | –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (excel/csv/json/raw) | json |
| `--fields` | –ü–æ–ª—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–∑ NTC | –≤—Å–µ |

### 7. match-mac ‚Äî –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ MAC —Å —Ö–æ—Å—Ç–∞–º–∏
```bash
python -m network_collector match-mac --mac-file mac.xlsx --hosts-file glpi.xlsx [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--mac-file` | Excel —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏ | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
| `--hosts-file` | Excel —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º —Ö–æ—Å—Ç–æ–≤ | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
| `--hosts-folder` | –ü–∞–ø–∫–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ | - |
| `--mac-column` | –ö–æ–ª–æ–Ω–∫–∞ —Å MAC –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ | MAC |
| `--name-column` | –ö–æ–ª–æ–Ω–∫–∞ —Å –∏–º–µ–Ω–µ–º —Ö–æ—Å—Ç–∞ | Name |
| `--output`, `-o` | –§–∞–π–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | matched_data.xlsx |

### 8. push-descriptions ‚Äî –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π –ø–æ—Ä—Ç–æ–≤
```bash
python -m network_collector push-descriptions --matched-file matched.xlsx [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--matched-file` | Excel —Å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏ | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
| `--only-empty` | –¢–æ–ª—å–∫–æ –ø–æ—Ä—Ç—ã –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è | - |
| `--overwrite` | –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ | - |
| `--dry-run` | –†–µ–∂–∏–º —Å–∏–º—É–ª—è—Ü–∏–∏ | True |
| `--apply` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è | - |

### 9. sync-netbox ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å NetBox
```bash
python -m network_collector sync-netbox [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--url` | URL NetBox (–∏–ª–∏ env NETBOX_URL) | env |
| `--token` | API —Ç–æ–∫–µ–Ω (–∏–ª–∏ env NETBOX_TOKEN) | env |
| `--sync-all` | –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | - |
| `--create-devices` | –°–æ–∑–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | - |
| `--update-devices` | –û–±–Ω–æ–≤–ª—è—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (serial, model) | - |
| `--interfaces` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã | - |
| `--ip-addresses` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å IP-–∞–¥—Ä–µ—Å–∞ | - |
| `--vlans` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å VLAN | - |
| `--cables` | –°–æ–∑–¥–∞—Ç—å –∫–∞–±–µ–ª–∏ –∏–∑ LLDP/CDP | - |
| `--inventory` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å inventory | - |
| `--protocol` | –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å–æ—Å–µ–¥–µ–π (lldp/cdp/both) | both |
| `--site` | –°–∞–π—Ç –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | –∏–∑ config |
| `--role` | –†–æ–ª—å –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | –∏–∑ config |
| `--tenant` | –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä (–¥–ª—è --cleanup) | - |
| `--cleanup` | –£–¥–∞–ª—è—Ç—å –ª–∏—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | - |
| `--dry-run` | –†–µ–∂–∏–º —Å–∏–º—É–ª—è—Ü–∏–∏ | - |
| `--create-only` | –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ | - |
| `--skip-unknown` | –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–æ—Å–µ–¥–µ–π –±–µ–∑ hostname | True |

### 10. backup ‚Äî –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
```bash
python -m network_collector backup [OPTIONS]
```
| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|----------|---------|
| `--output`, `-o` | –ü–∞–ø–∫–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π | backups |

---

## –ö–û–ú–ê–ù–î–´ –£–°–¢–†–û–ô–°–¢–í (show commands)

–ö–æ–º–∞–Ω–¥—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –Ω–∞ —Å–µ—Ç–µ–≤–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

### devices (–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe / cisco_nxos | `show version` |
| arista_eos | `show version` |
| juniper_junos | `show version` |

### mac (MAC-–∞–¥—Ä–µ—Å–∞)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe / cisco_nxos | `show mac address-table` |
| arista_eos | `show mac address-table` |
| juniper_junos | `show ethernet-switching table` |
| qtech / qtech_qsw | `show mac address-table` |

### lldp (—Å–æ—Å–µ–¥–∏ LLDP)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe / cisco_nxos | `show lldp neighbors detail` |
| arista_eos | `show lldp neighbors detail` |
| juniper_junos | `show lldp neighbors` |

### lldp --protocol cdp (—Å–æ—Å–µ–¥–∏ CDP)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe / cisco_nxos | `show cdp neighbors detail` |

### interfaces (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe | `show interfaces` |
| cisco_nxos | `show interface` |
| arista_eos | `show interfaces` |
| juniper_junos | `show interfaces extensive` |

### interfaces (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã)
| –î–∞–Ω–Ω—ã–µ | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|--------|-----------|---------|
| LAG membership | cisco_ios / cisco_iosxe | `show etherchannel summary` |
| LAG membership | cisco_nxos / arista_eos | `show port-channel summary` |
| Switchport mode | cisco_ios / cisco_iosxe | `show interfaces switchport` |
| Switchport mode | cisco_nxos | `show interface switchport` |
| Switchport mode | arista_eos | `show interfaces switchport` |

### inventory (–º–æ–¥—É–ª–∏, SFP, PSU)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe / cisco_nxos | `show inventory` |
| arista_eos | `show inventory` |

### backup (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|---------|
| cisco_ios / cisco_iosxe / cisco_nxos / cisco_iosxr | `show running-config` |
| arista_eos | `show running-config` |
| juniper_junos | `show configuration \| display set` |
| qtech / qtech_qsw | `show running-config` |

---

### –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è Cisco IOS/IOS-XE

```
# –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
show version

# MAC-–∞–¥—Ä–µ—Å–∞
show mac address-table

# –°–æ—Å–µ–¥–∏
show lldp neighbors detail
show cdp neighbors detail

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
show interfaces
show interfaces switchport
show etherchannel summary

# –ú–æ–¥—É–ª–∏ –∏ —Ç—Ä–∞–Ω—Å–∏–≤–µ—Ä—ã
show inventory

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
show running-config
```

---

8. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –£–¢–ò–õ–ò–¢–´

–ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –ø–∞—Ä—Å–µ—Ä—ã, –∫–æ–ª–ª–µ–∫—Ç–æ—Ä—ã, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–µ–Ω–¥–æ—Ä–æ–≤/—É—Å—Ç—Ä–æ–π—Å—Ç–≤.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ fixtures/                    # –†–µ–∞–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∫–æ–º–∞–Ω–¥ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îÇ   ‚îú‚îÄ‚îÄ cisco_ios/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ show_interfaces.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ show_mac_address_table.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ show_lldp_neighbors_detail.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ show_cdp_neighbors_detail.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ show_interfaces_switchport.txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ show_etherchannel_summary.txt
‚îÇ   ‚îú‚îÄ‚îÄ cisco_nxos/
‚îÇ   ‚îú‚îÄ‚îÄ arista_eos/
‚îÇ   ‚îú‚îÄ‚îÄ juniper_junos/
‚îÇ   ‚îî‚îÄ‚îÄ qtech/
‚îÇ
‚îú‚îÄ‚îÄ test_parsers/                # –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—ã–≤–æ–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_interfaces.py       # show interfaces
‚îÇ   ‚îú‚îÄ‚îÄ test_mac.py              # show mac address-table
‚îÇ   ‚îú‚îÄ‚îÄ test_lldp.py             # show lldp/cdp neighbors
‚îÇ   ‚îú‚îÄ‚îÄ test_switchport.py       # show interfaces switchport
‚îÇ   ‚îî‚îÄ‚îÄ test_lag.py              # show etherchannel summary
‚îÇ
‚îú‚îÄ‚îÄ test_collectors/             # –¢–µ—Å—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_normalize.py        # –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤—ã–≤–æ–¥–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
‚îÇ   ‚îú‚îÄ‚îÄ test_merge_lldp_cdp.py   # –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ LLDP + CDP
‚îÇ   ‚îî‚îÄ‚îÄ test_switchport_mode.py  # tagged vs tagged-all
‚îÇ
‚îú‚îÄ‚îÄ test_netbox/                 # –¢–µ—Å—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Å mock API)
‚îÇ   ‚îú‚îÄ‚îÄ test_sync_interfaces.py
‚îÇ   ‚îú‚îÄ‚îÄ test_sync_cables.py
‚îÇ   ‚îî‚îÄ‚îÄ test_find_neighbor.py
‚îÇ
‚îî‚îÄ‚îÄ conftest.py                  # –û–±—â–∏–µ fixtures, MockDevice
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ú–æ–¥—É–ª—å | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |
|-----------|--------|-----------------|
| üî¥ –í—ã—Å–æ–∫–∏–π | parsers | –ü–∞—Ä—Å–∏–Ω–≥ –≤—ã–≤–æ–¥–æ–≤ (regex + NTC fallback) |
| üî¥ –í—ã—Å–æ–∫–∏–π | normalize | –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø–æ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º |
| üî¥ –í—ã—Å–æ–∫–∏–π | switchport | tagged vs tagged-all –ª–æ–≥–∏–∫–∞ |
| üü° –°—Ä–µ–¥–Ω–∏–π | lldp merge | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ LLDP + CDP –¥–∞–Ω–Ω—ã—Ö |
| üü° –°—Ä–µ–¥–Ω–∏–π | lag | LAG membership –ø–∞—Ä—Å–∏–Ω–≥ |
| üü¢ –ù–∏–∑–∫–∏–π | netbox sync | –¢—Ä–µ–±—É–µ—Ç mock pynetbox API |

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è

```python
REQUIRED_FIELDS = {
    "interfaces": ["interface", "status", "mac", "description", "mode"],
    "mac": ["mac", "vlan", "interface", "type"],
    "lldp": ["local_interface", "remote_hostname", "remote_port", "neighbor_type"],
    "inventory": ["name", "part_id", "serial", "description"],
}
```

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

1. –ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:
   - –í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
   - –°—Ç–∞—Ç—É—Å—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (up/down/disabled/error)
   - MAC-–∞–¥—Ä–µ—Å–∞ –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

2. Switchport mode:
   - trunk + "Trunking VLANs: ALL" ‚Üí tagged-all
   - trunk + "Trunking VLANs: 10,20,30" ‚Üí tagged
   - access ‚Üí access

3. LLDP/CDP merge:
   - LLDP –¥–∞—ë—Ç MAC (chassis_id)
   - CDP –¥–∞—ë—Ç hostname –µ—Å–ª–∏ LLDP –Ω–µ –¥–∞–ª system_name
   - –°–æ—Å–µ–¥–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–æ local_interface

4. –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤—ã–≤–æ–¥–∞:
   - –í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –ù–æ–≤—ã–π –≤–µ–Ω–¥–æ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã

### –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π –≤–µ–Ω–¥–æ—Ä

1. –°–æ–±—Ä–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∫–æ–º–∞–Ω–¥ ‚Üí tests/fixtures/new_vendor/
2. –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã ‚Äî —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –ø–∞–¥–∞–µ—Ç
4. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥/–º–∞–ø–ø–∏–Ω–≥ –≤ –∫–æ–¥
5. –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pytest
pip install pytest pytest-cov

# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –¢–æ–ª—å–∫–æ –ø–∞—Ä—Å–µ—Ä—ã
pytest tests/test_parsers/ -v

# –° coverage –æ—Ç—á—ë—Ç–æ–º
pytest tests/ --cov=network_collector --cov-report=html

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_parsers/test_switchport.py -v
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```
# requirements-dev.txt
pytest>=7.0
pytest-cov>=4.0
pytest-mock>=3.0
```

---

# ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (2025-12-27)

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| RunContext | ‚úÖ | run_id, dry_run, timing, output_dir |
| Data Models | ‚úÖ | Interface, MACEntry, LLDPNeighbor, InventoryItem |
| Typed Exceptions | ‚úÖ | –ò–µ—Ä–∞—Ä—Ö–∏—è –æ—à–∏–±–æ–∫, is_retryable |
| Structured Logs | ‚úÖ | JSON —Ñ–æ—Ä–º–∞—Ç, —Ä–æ—Ç–∞—Ü–∏—è, LogConfig |
| Diff before Apply | ‚úÖ | DiffCalculator, preview changes |
| Config Validation | ‚úÖ | Pydantic —Å—Ö–µ–º—ã (config_schema.py) |
| Domain Layer | ‚úÖ | InterfaceNormalizer, MACNormalizer, LLDPNormalizer, InventoryNormalizer |
| Tests | ‚úÖ | 621 —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥—è—Ç |

## Domain Layer ‚Äî –≥–æ—Ç–æ–≤

```
core/domain/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ interface.py   # InterfaceNormalizer (57 —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ mac.py         # MACNormalizer (47 —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ lldp.py        # LLDPNormalizer (31 —Ç–µ—Å—Ç)
‚îî‚îÄ‚îÄ inventory.py   # InventoryNormalizer (31 —Ç–µ—Å—Ç)
```

---

# üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Domain Layer

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Collectors

–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Normalizers –≤ collectors:

```python
# collectors/interfaces.py (–¢–ï–ö–£–©–ò–ô)
class InterfaceCollector:
    def collect(self, devices) -> List[Dict]:
        ...  # –ª–æ–≥–∏–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏

# collectors/interfaces.py (–¶–ï–õ–ï–í–û–ô)
from core.domain import InterfaceNormalizer

class InterfaceCollector:
    def __init__(self):
        self.normalizer = InterfaceNormalizer()

    def collect(self, devices) -> List[Dict]:
        raw_data = self._collect_raw(devices)
        return self.normalizer.normalize_dicts(raw_data)

    def collect_models(self, devices) -> List[Interface]:
        raw_data = self._collect_raw(devices)
        return self.normalizer.normalize(raw_data)
```

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å NetBox Sync

```python
# netbox/sync.py (–¶–ï–õ–ï–í–û–ô)
from core.domain import InterfaceNormalizer

class NetBoxSync:
    def __init__(self):
        self.interface_normalizer = InterfaceNormalizer()

    def sync_interfaces(self, device, raw_interfaces):
        # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Domain Layer
        interfaces = self.interface_normalizer.normalize(raw_interfaces)

        for intf in interfaces:
            # –†–∞–±–æ—Ç–∞ —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
            port_type = intf.port_type  # —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
            mode = intf.mode  # —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
```

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: Unit-—Ç–µ—Å—Ç—ã –±–µ–∑ SSH

```python
# tests/test_collectors/test_interface_collector.py
def test_collector_uses_normalizer():
    """Collector –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Domain Layer –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏."""
    raw_data = [{"interface": "Gi0/1", "link_status": "up"}]

    collector = InterfaceCollector()
    result = collector.collect_models(mock_device_with_data(raw_data))

    assert result[0].status == "up"
    assert result[0].port_type == "1g-rj45"
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **Collectors** ‚Äî —Ç–æ–ª—å–∫–æ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (SSH, –ø–∞—Ä—Å–∏–Ω–≥)
- **Domain Layer** ‚Äî –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- **NetBox Sync** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- **–¢–µ—Å—Ç—ã** ‚Äî –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ SSH –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
